<!-- Single item content for fullscreen view -->
<div class="study-item-container">
    <div class="study-content-wrapper">
        {% if review %}
            <!-- Show first text if available -->
            {% for text in review.music_item.texts.all %}
                {% if forloop.first %}
                    <div class="study-text-content">
                        {% if 'X:' in text.content %}
                            <!-- ABC Notation -->
                            <div class="abc-notation-fullscreen" 
                                 id="abc-fs-{{ text.id }}"
                                 data-abc-content="{{ text.content|safe }}">
                            </div>
                            <script>
                                // Render ABC notation
                                setTimeout(() => {
                                    if (window.ABCJS) {
                                        ABCJS.renderAbc('abc-fs-{{ text.id }}', `{{ text.content|safe }}`, {
                                            responsive: "resize",
                                            viewportHorizontal: true,
                                            scrollHorizontal: true
                                        });
                                    }
                                }, 100);
                            </script>
                        {% else %}
                            <!-- Chord sheets -->
                            <div class="chord-sheet-fullscreen" 
                                 id="chord-fs-{{ text.id }}"
                                 data-chord-content="{{ text.content|safe }}">
                                <!-- Content will be rendered by JavaScript -->
                            </div>
                            <script>
                                // Render chord sheet
                                setTimeout(() => {
                                    const container = document.getElementById('chord-fs-{{ text.id }}');
                                    if (container && window.parseUltimateGuitarChords) {
                                        const content = `{{ text.content|safe }}`;
                                        container.innerHTML = parseUltimateGuitarChords(content);
                                    }
                                }, 100);
                            </script>
                        {% endif %}
                    </div>
                {% endif %}
            {% empty %}
                <!-- Show first file if no texts -->
                {% for file in review.music_item.files.all %}
                    {% if forloop.first %}
                        {% if '.pdf' in file.file.name %}
                            <!-- PDF content -->
                            <div class="study-pdf-content">
                                <iframe src="{{ file.file.url }}" 
                                        class="w-full h-full border-0">
                                </iframe>
                            </div>
                        {% elif file.file.name|slice:"-4:" in ".mp3,.wav,.m4a" %}
                            <!-- Audio content -->
                            <div class="study-audio-content">
                                <div class="audio-player-fullscreen">
                                    <audio controls class="w-full max-w-2xl mx-auto">
                                        <source src="{{ file.file.url }}" type="audio/mpeg">
                                    </audio>
                                    <div class="audio-info mt-4 text-center">
                                        <h3 class="text-2xl font-bold mb-2">{{ file.name }}</h3>
                                        <p class="text-lg text-gray-600">{{ review.music_item.title }}</p>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <!-- Video content -->
                            <div class="study-video-content">
                                <video controls class="max-w-full max-h-full mx-auto">
                                    <source src="{{ file.file.url }}" type="video/mp4">
                                </video>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% endfor %}
        {% else %}
            <div class="flex items-center justify-center h-full">
                <p class="text-2xl text-gray-500">No hay contenido disponible</p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Update progress bar -->
<script>
    const progressBar = document.querySelector('.progress-bar');
    if (progressBar) {
        progressBar.style.width = '{{ current_index|add:1|floatformat:0 }}' / {{ total_items }} * 100 + '%';
    }
</script>
