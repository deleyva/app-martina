{% extends 'base.html' %}
{% load static %}

{% block title %}Music Item Detail{% endblock %}
{% block content %}

<div class="container mx-auto p-6">
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <div class="flex items-center justify-between mb-6">
                <h1 class="card-title text-4xl">{{ music_item.title }}</h1>
                <div class="flex gap-2">
                    <a href="{% url 'music_cards:music_items_list' %}" class="btn btn-outline btn-primary">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Volver a la lista
                    </a>
                    {% if user.is_staff or user.is_superuser %}
                        <a href="{% url 'admin:music_cards_musicitem_change' music_item.id %}" class="btn btn-outline btn-warning">
                            <i class="fas fa-edit mr-2"></i>
                            Editar
                        </a>
                    {% endif %}
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">Fecha de creaci칩n</div>
                        <div class="stat-value text-lg">{{ music_item.created_at|date:"d/m/Y" }}</div>
                    </div>
                </div>
                
                {% if xml_file %}
                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">Archivo XML</div>
                        <div class="stat-value text-sm">
                            <a href="{{ xml_file.file.url }}" class="link link-primary" target="_blank">
                                <i class="fas fa-download mr-1"></i>
                                Descargar
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-title">Etiquetas</div>
                        <div class="stat-value text-sm">{{ music_item.tags.count }} tags</div>
                    </div>
                </div>
            </div>

            {% if music_item.tags.all %}
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3">Etiquetas:</h3>
                <div class="flex flex-wrap gap-2">
                    {% for tag in music_item.tags.all %}
                        <div class="badge badge-outline badge-lg">
                            <span class="font-medium">{{ tag.key }}</span>
                            {% if tag.value %}
                                <span class="ml-1">: {{ tag.value }}</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="divider">Contenido Musical</div>

            {% if text %}
                <div class="bg-base-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Notaci칩n ABC</h3>
                    <div id="abc-container" 
                         data-abc-content="{{ text.content|escapejs }}"
                         class="abc-notation-container"></div>
                </div>
            {% elif xml_file %}
                <div class="bg-base-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Partitura (XML)</h3>
                    <div id="osmdContainer" class="min-h-96"></div>
                    <!-- OpenSheetMusicDisplay no est치 disponible actualmente -->
                    <script>
                        /*
                        var xmlFileUrl = "{{ xml_file.file.url|escapejs }}";
                        console.log("XML file URL:", xmlFileUrl);
                        var osmd = new opensheetmusicdisplay.OpenSheetMusicDisplay("osmdContainer");
                        osmd.setOptions({
                            backend: "svg",
                            drawTitle: false,
                            drawSubtitle: false,
                            drawLyricist: false,
                            drawComposer: false,
                            drawPartNames: false,
                        });
                        osmd.load(xmlFileUrl).then(function () {
                            osmd.render();
                        });
                        */
                        console.log("OpenSheetMusicDisplay no est치 disponible");
                    </script>
                </div>
            {% else %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>No hay contenido musical disponible para este elemento.</span>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock content %}


{% comment %} {% block extrajs %}
<script>
    const observer = new MutationObserver((mutationsList) => {
        for (let mutation of mutationsList) {
            if (mutation.type === 'childList') {
                const vfTextElements = document.querySelectorAll('.vf-text');
                vfTextElements.forEach(element => {
                    element.style.display = 'none';
                });
            }
        }
    });
    observer.observe(document.body, { childList: true, subtree: true });
</script>

{% endblock extrajs %} {% endcomment %}
    
