{% extends "cms/base_blog.html" %}
{% load wagtailcore_tags wagtailimages_tags %}
{% load library_tags %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <h1 class="text-5xl font-bold font-serif-title mb-10 text-center">{{ page.title }}</h1>
    
    {% if page.intro %}
    <div class="max-w-3xl mx-auto text-xl italic text-gray-700 text-center mb-16 leading-relaxed">
        {{ page.intro|richtext }}
    </div>
    {% endif %}

    <div class="editorial-divider"></div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12">
        {% for blog in blogpages %}
        {% with item=blog.specific %}
        <article class="group pb-8 border-b md:border-b-0 md:border-r border-gray-200 pr-0 md:pr-8 last:border-0 last:pr-0">
            {% if blog.specific.featured_image %}
            <a href="{% pageurl blog %}" class="block overflow-hidden mb-6">
                <!-- Efecto B/W a Color on Hover -->
                {% image blog.specific.featured_image width-600 class="w-full h-64 object-cover bw-image-hover" %}
            </a>
            {% endif %}
            
            <div>
                <!-- Titular Grande y Elegante -->
                <h2 class="text-3xl font-bold font-serif-title mb-4 leading-tight">
                    <a href="{% pageurl blog %}" class="text-black hover:underline decoration-2 underline-offset-4">
                        {{ blog.title }}
                    </a>
                </h2>
                
                <!-- Metadatos minimalistas -->
                <div class="flex items-center text-xs font-sans tracking-widest text-gray-500 uppercase mb-4">
                    {% if blog.specific.date %}
                        <span>{{ blog.specific.date|date:"j M, Y" }}</span>
                    {% endif %}
                    {% if blog.specific.categories.all %}
                        <span class="mx-2">•</span>
                        <span>{{ blog.specific.categories.first.name }}</span>
                    {% endif %}
                </div>
                
                <!-- Extracto -->
                {% if blog.specific.intro %}
                <p class="text-gray-800 text-lg mb-6 leading-relaxed">{{ blog.specific.intro|truncatechars:150 }}</p>
                {% endif %}
                
                <!-- Botonera -->
                <div class="flex items-center justify-between mt-auto">
                    <a href="{% pageurl blog %}" class="text-xs font-sans uppercase tracking-widest font-bold hover:text-gray-500 transition-colors">
                        Leer Artículo
                    </a>
                    {% if user.is_authenticated %}
                    <div id="library-btn-blog-{{ item.pk }}" onclick="event.stopPropagation()">
                        {% library_button item %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </article>
        {% endwith %}
        {% empty %}
        <p class="col-span-full text-gray-500 text-center py-16 italic text-xl">Aún no hay artículos publicados en esta sección.</p>
        {% endfor %}
    </div>

    <div class="editorial-divider-thick"></div>
</div>
{% endblock %}
