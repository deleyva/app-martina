{% extends "cms/base_blog.html" %}
{% load wagtailcore_tags wagtailimages_tags %}
{% load library_tags %}

{% block title %}{{ page.title }} - IES Martina Bescós{% endblock %}

{% block extra_css %}
<style>
    /* Tipografía y espaciado editorial para el contenido del artículo (Jot Down style) */
    .article-content {
        font-size: 1.125rem;
        line-height: 1.8;
        color: #111;
        text-align: justify;
        hyphens: auto;
    }
    
    .article-content p {
        margin-bottom: 1.5rem;
    }

    .article-content p:first-of-type::first-letter {
        font-family: 'Playfair Display', serif;
        float: left;
        font-size: 5rem;
        line-height: 4rem;
        padding-top: 4px;
        padding-right: 8px;
        padding-left: 3px;
    }
    
    .article-content h2, .article-content h3 {
        font-family: 'Playfair Display', serif;
        font-weight: 700;
        margin-top: 2.5rem;
        margin-bottom: 1.25rem;
        color: #000;
        text-align: left;
    }

    .article-content h2 { font-size: 2.25rem; }
    .article-content h3 { font-size: 1.75rem; }
    
    .article-content blockquote {
        margin: 2.5rem 0;
        padding: 1.5rem 2rem;
        border-left: 4px solid #000;
        font-style: italic;
        font-size: 1.5rem;
        line-height: 1.6;
        color: #333;
        background-color: #f9fafb;
    }
    
    .article-content a {
        border-bottom: 1px solid #111;
        transition: all 0.2s ease;
    }

    .article-content a:hover {
        background-color: #111;
        color: #fff;
    }

    .article-content img {
        margin: 2rem auto;
        max-width: 100%;
        height: auto;
    }
</style>
{% endblock %}

{% block content %}
<article class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header del Artículo -->
    <header class="mb-12 text-center">
        <!-- Metadatos Superiores -->
        <div class="flex items-center justify-center gap-4 text-xs font-sans tracking-widest text-gray-500 uppercase mb-8">
            {% if page.date %}
            <span>{{ page.date|date:"j de F, Y" }}</span>
            {% endif %}
            
            {% if page.categories.all %}
            <span>•</span>
            <span>{{ page.categories.first.name }}</span>
            {% endif %}
            
            <!-- Botonera Admin/Librería integrada en los metadatos -->
            {% if user.is_authenticated %}
            <span>•</span>
            <div id="library-btn-blogpage-{{ page.pk }}" class="inline-block">
                {% library_button page %}
            </div>
            {% if user.is_staff %}
            <a href="/cms/pages/{{ page.id }}/edit/" class="hover:text-black hover:underline" aria-label="Editar">
                (Editar)
            </a>
            {% endif %}
            {% endif %}
        </div>

        <!-- Título principal -->
        <h1 class="text-5xl md:text-7xl font-bold font-serif-title mb-8 leading-tight text-black">{{ page.title }}</h1>
        
        <!-- Intro / Entradilla -->
        {% if page.intro %}
        <div class="text-2xl italic text-gray-600 font-serif-title max-w-3xl mx-auto leading-relaxed">
            {{ page.intro }}
        </div>
        {% endif %}
    </header>

    <!-- Imagen Destacada -->
    {% if page.featured_image %}
    <figure class="mb-16">
        <!-- Manteniendo el estilo editorial, la imagen principal suele ir apaisada y a todo ancho -->
        {% image page.featured_image width-1200 class="w-full h-auto object-cover border-b-4 border-black pb-2" %}
    </figure>
    {% endif %}

    <!-- Cuerpo del Artículo -->
    {% if page.body %}
    <div class="article-content font-serif mx-auto max-w-3xl">
        {{ page.body|richtext }}
    </div>
    {% endif %}

    <div class="editorial-divider-thick mt-20"></div>

    <!-- Categorías y Tags al final -->
    {% if page.categories.all or page.tags.all %}
    <div class="mt-8 font-sans text-sm tracking-wide text-gray-500">
        <div class="flex flex-wrap items-center gap-4">
            <span class="uppercase font-bold text-black tracking-widest">Archivado en:</span>
            {% for category in page.categories.all %}
            <span class="hover:text-black cursor-pointer">{% if category.icon %}{{ category.icon }} {% endif %}{{ category.name }}</span>
            {% endfor %}
            {% for tag in page.tags.all %}
            <span class="hover:text-black cursor-pointer">#{{ tag.name }}</span>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Navegación: Volver al Índice -->
    <div class="mt-12 text-center font-sans tracking-widest uppercase text-sm">
        <a href="{{ page.get_parent.get_url }}" class="inline-block py-2 px-6 border border-black text-black hover:bg-black hover:text-white transition-colors">
            Volver a Portada
        </a>
    </div>
    
</article>
{% endblock %}
